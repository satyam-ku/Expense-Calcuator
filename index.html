<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NeonFlux | Expense & Lending</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: '#050505',
                        glass: 'rgba(20, 20, 30, 0.7)',
                        neonBlue: '#00f3ff',
                        neonPink: '#ff00ff',
                        neonGreen: '#00ff9d',
                        neonPurple: '#bf00ff',
                        neonRed: '#ff3333'
                    },
                    fontFamily: {
                        mono: ['"Courier New"', 'monospace'],
                        sans: ['ui-sans-serif', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    },
                    animation: {
                        'pop-in': 'popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                    },
                    keyframes: {
                        popIn: {
                            '0%': { opacity: '0', transform: 'scale(0.9)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #050505;
            background-image: 
                radial-gradient(at 0% 0%, rgba(255, 0, 255, 0.15) 0px, transparent 40%),
                radial-gradient(at 100% 100%, rgba(0, 243, 255, 0.15) 0px, transparent 40%);
            background-attachment: fixed;
            -webkit-tap-highlight-color: transparent;
        }
        
        .glass-card {
            background: rgba(20, 20, 30, 0.7);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        .input-center {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.2s ease;
            font-size: 16px; 
            text-align: center; /* Centered Text inside Input */
        }
        
        .input-center:focus {
            outline: none;
            border-color: #00f3ff;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.2);
            background: rgba(0, 0, 0, 0.6);
            transform: scale(1.02);
        }

        .tab-btn.active {
            background: rgba(255, 255, 255, 0.1);
            border-bottom: 2px solid #00f3ff;
            color: #00f3ff;
            text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
        }

        #personDetailOverlay.open { transform: translateY(0); }
        #personDetailOverlay.closed { transform: translateY(100%); }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    </style>
</head>
<body class="min-h-screen text-gray-100 font-sans selection:bg-neonPink selection:text-white pb-6 overflow-x-hidden">

    <header class="pt-8 pb-2 px-4 text-center sticky top-0 z-40 bg-[#050505]/90 backdrop-blur-xl border-b border-white/5">
        <h1 class="text-3xl font-extrabold tracking-tighter mb-4 bg-clip-text text-transparent bg-gradient-to-r from-neonBlue via-white to-neonPink">
            NEON<span class="font-light italic">FLUX</span>
        </h1>
        
        <div class="flex justify-center gap-6 text-sm uppercase tracking-widest font-bold">
            <button onclick="switchTab('expenses')" id="btn-tab-expenses" class="tab-btn active pb-2 px-4 transition-all text-gray-500 hover:text-white">
                Expenses
            </button>
            <button onclick="switchTab('people')" id="btn-tab-people" class="tab-btn pb-2 px-4 transition-all text-gray-500 hover:text-white">
                People Ledger
            </button>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-3 md:px-4 py-6 relative">
        
        <div id="tab-expenses-content" class="grid grid-cols-1 lg:grid-cols-12 gap-4 md:gap-6 animate-pop-in">
            
            <div class="lg:col-span-4 space-y-4">
                <div class="glass-card rounded-2xl p-5 relative overflow-hidden flex flex-col items-center text-center">
                    <div class="absolute top-0 w-full h-1 bg-neonPink"></div>
                    <h2 class="text-xs font-bold text-gray-400 mb-2 uppercase tracking-wide">Monthly Budget</h2>
                    <div class="flex flex-col items-center gap-2 w-full max-w-[200px]">
                        <input type="number" id="budgetInput" placeholder="Set Limit" class="input-center w-full p-2 rounded-lg font-mono">
                        <button onclick="setBudget()" class="w-full bg-neonPink text-black font-bold py-1 px-4 rounded-lg text-xs hover:bg-white transition">UPDATE LIMIT</button>
                    </div>
                </div>

                <div class="glass-card rounded-2xl p-6 text-center space-y-3 relative">
                    <div class="absolute top-0 right-0 w-1 h-full bg-neonBlue"></div>
                    <p class="text-[10px] text-gray-400 uppercase tracking-widest">Available Balance</p>
                    <div class="text-5xl font-mono font-bold text-neonBlue drop-shadow-[0_0_10px_rgba(0,243,255,0.4)]">₹<span id="displayBalance">0.00</span></div>
                    
                    <div class="w-full bg-black/40 h-2 rounded-full overflow-hidden border border-white/5 mx-auto max-w-[250px]">
                        <div id="progressBar" class="h-full bg-gradient-to-r from-neonBlue to-neonPink w-0"></div>
                    </div>
                    
                    <div class="flex justify-between text-xs px-4 text-gray-500 font-mono">
                        <span>Limit: ₹<span id="displayBudget">0</span></span>
                        <span>Spent: <span id="displaySpent" class="text-red-400">₹0</span></span>
                    </div>
                </div>

                <div class="glass-card rounded-2xl p-5 text-center">
                    <h2 class="text-xs font-bold text-gray-400 mb-3 uppercase tracking-wide">Monthly Breakdown</h2>
                    <div class="flex flex-col items-center space-y-2" id="monthlySummaryList"></div>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-4">
                
                <div class="glass-card rounded-2xl p-8 border border-neonGreen/30 relative overflow-hidden text-center">
                    <div class="absolute inset-0 bg-neonGreen/5 pointer-events-none"></div>
                    <h2 class="text-lg font-bold text-white mb-6 uppercase tracking-[0.2em] flex items-center justify-center gap-2">
                        <i class="fa-solid fa-bolt text-neonGreen"></i> New Expense
                    </h2>
                    
                    <div class="flex flex-col items-center gap-4 max-w-md mx-auto">
                        <input type="text" id="expenseName" placeholder="What did you buy?" class="input-center w-full p-4 rounded-xl text-lg placeholder-gray-500">
                        <div class="flex items-center gap-2 w-full">
                            <span class="text-2xl text-neonGreen font-bold">₹</span>
                            <input type="number" id="expenseAmount" placeholder="0.00" class="input-center w-full p-4 rounded-xl text-2xl font-mono text-neonGreen placeholder-gray-600">
                        </div>
                        <button onclick="addExpense()" class="w-full bg-gradient-to-r from-neonGreen to-emerald-600 text-black font-bold py-4 rounded-xl shadow-[0_0_20px_rgba(0,255,157,0.3)] hover:shadow-[0_0_30px_rgba(0,255,157,0.5)] active:scale-95 transition-all text-lg tracking-widest uppercase">
                            ADD TO LOG
                        </button>
                    </div>
                </div>

                <div class="glass-card rounded-2xl min-h-[300px] overflow-hidden">
                    <div class="p-4 bg-white/5 border-b border-white/5 flex justify-between items-center px-6">
                        <h3 class="font-bold text-sm tracking-wide">RECENT ACTIVITY</h3>
                        <button onclick="resetExpenses()" class="text-[10px] text-red-400 border border-red-500/30 px-3 py-1 rounded hover:bg-red-500/10">CLEAR</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <tbody id="expenseList" class="text-sm divide-y divide-gray-800"></tbody>
                        </table>
                        <div id="emptyState" class="hidden py-12 text-center text-gray-600"><p class="text-xs">No transactions recorded.</p></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-people-content" class="hidden animate-pop-in">
            
            <div class="glass-card rounded-2xl p-8 mb-8 border border-neonBlue/30 text-center max-w-lg mx-auto relative overflow-hidden">
                <div class="absolute inset-0 bg-neonBlue/5 pointer-events-none"></div>
                <label class="block text-sm text-neonBlue font-bold uppercase tracking-[0.2em] mb-6">
                    <i class="fa-solid fa-user-plus mr-2"></i> Add New Person
                </label>
                <div class="flex flex-col items-center gap-4">
                    <input type="text" id="newPersonName" placeholder="Enter Name (e.g. Rahul)" class="input-center w-full p-4 rounded-xl text-lg">
                    <button onclick="addPerson()" class="w-full bg-neonBlue text-black font-bold py-3 rounded-xl shadow-[0_0_20px_rgba(0,243,255,0.3)] active:scale-95 hover:bg-white transition-all tracking-widest">
                        CREATE LEDGER
                    </button>
                </div>
            </div>

            <div id="peopleGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                </div>
             <div id="peopleEmptyState" class="hidden py-16 text-center text-gray-500">
                <i class="fa-solid fa-users text-4xl mb-3 opacity-30"></i>
                <p>No people added yet.</p>
            </div>
        </div>
    </main>

    <div id="personDetailOverlay" class="fixed inset-0 z-50 bg-[#050505] closed flex flex-col h-full w-full overflow-hidden transition-transform duration-300">
        <div class="p-4 flex items-center justify-between border-b border-white/10 bg-gray-900/50 backdrop-blur-md">
            <button onclick="closePersonDetails()" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center hover:bg-white/10 text-white">
                <i class="fa-solid fa-arrow-left"></i>
            </button>
            <h2 class="text-xl font-bold text-white tracking-wide" id="detailPersonName">Name</h2>
            <button onclick="deleteCurrentPerson()" class="text-red-400 text-xs uppercase tracking-widest border border-red-500/30 px-3 py-1 rounded-lg hover:bg-red-500/10">Delete</button>
        </div>

        <div class="flex-1 overflow-y-auto p-4 space-y-6 flex flex-col items-center">
            
            <div class="glass-card p-8 rounded-3xl text-center relative overflow-hidden w-full max-w-md mt-4">
                <p class="text-gray-400 text-xs uppercase tracking-[0.2em] mb-2">Net Balance</p>
                <div class="text-5xl font-mono font-bold text-white mb-2" id="detailBalance">₹0</div>
                <p class="text-xs text-gray-500" id="detailStatus">Settled</p>
            </div>

            <div class="grid grid-cols-2 gap-4 w-full max-w-md">
                <button onclick="openTransactionModal('GAVE')" class="p-5 rounded-2xl bg-red-500/10 border border-red-500/30 text-red-400 hover:bg-red-500/20 active:scale-95 transition-all flex flex-col items-center gap-2">
                    <i class="fa-solid fa-arrow-up text-2xl"></i>
                    <span class="text-xs font-bold uppercase tracking-widest">You Gave</span>
                </button>
                <button onclick="openTransactionModal('GOT')" class="p-5 rounded-2xl bg-green-500/10 border border-green-500/30 text-green-400 hover:bg-green-500/20 active:scale-95 transition-all flex flex-col items-center gap-2">
                    <i class="fa-solid fa-arrow-down text-2xl"></i>
                    <span class="text-xs font-bold uppercase tracking-widest">You Got</span>
                </button>
            </div>

            <div class="w-full max-w-md">
                <h3 class="text-sm text-gray-500 font-bold uppercase mb-4 text-center tracking-widest">History</h3>
                <div id="personHistoryList" class="space-y-3 pb-20">
                    </div>
            </div>
        </div>

        <div id="txInputModal" class="hidden fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
            <div class="glass-card w-full max-w-sm p-8 rounded-3xl border border-white/20 relative animate-pop-in text-center">
                
                <h3 class="text-xl font-bold mb-6 flex items-center justify-center gap-2">
                    <span id="txModalType" class="uppercase tracking-widest">Record</span>
                </h3>

                <div class="space-y-4">
                    <input type="text" id="txDesc" placeholder="Description (e.g. Lunch)" class="input-center w-full p-4 rounded-xl text-white">
                    
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">₹</span>
                        <input type="number" id="txAmt" placeholder="0" class="input-center w-full p-4 rounded-xl font-mono text-2xl">
                    </div>

                    <div class="grid grid-cols-2 gap-3 pt-4">
                        <button onclick="closeTxModal()" class="py-3 rounded-xl bg-gray-800 text-gray-400 font-bold hover:bg-gray-700 transition">CANCEL</button>
                        <button onclick="submitPersonTx()" class="py-3 rounded-xl bg-white text-black font-bold shadow-[0_0_20px_rgba(255,255,255,0.3)] hover:scale-105 transition">CONFIRM</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let currentTab = 'expenses';
        let expensesData = { budget: 0, list: [] };
        let peopleData = []; 
        let activePersonId = null;
        let activeTxType = null; 

        window.onload = function() {
            loadData();
            renderExpenses();
            renderPeopleGrid();
        };

        function switchTab(tab) {
            currentTab = tab;
            document.getElementById('tab-expenses-content').classList.add('hidden');
            document.getElementById('tab-people-content').classList.add('hidden');
            document.getElementById(`tab-${tab}-content`).classList.remove('hidden');

            document.getElementById('btn-tab-expenses').classList.remove('active');
            document.getElementById('btn-tab-people').classList.remove('active');
            document.getElementById(`btn-tab-${tab}`).classList.add('active');

            if(tab === 'people') renderPeopleGrid();
        }

        // --- EXPENSES ---
        
        function setBudget() {
            const val = parseFloat(document.getElementById('budgetInput').value);
            if(isNaN(val) || val <= 0) return alert("Invalid Amount");
            expensesData.budget = val;
            document.getElementById('budgetInput').value = '';
            saveAll(); renderExpenses();
        }

        function addExpense() {
            const name = document.getElementById('expenseName').value.trim();
            const amt = parseFloat(document.getElementById('expenseAmount').value);
            if(!name || isNaN(amt) || amt <= 0) return alert("Invalid Input");

            const now = new Date();
            expensesData.list.unshift({
                id: Date.now(),
                name: name,
                amount: amt,
                date: now.toLocaleDateString('en-IN', { month: 'short', day: 'numeric' }),
                time: now.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', hour12: true })
            });

            document.getElementById('expenseName').value = '';
            document.getElementById('expenseAmount').value = '';
            saveAll(); renderExpenses();
        }

        function deleteExpense(id) {
            if(confirm('Delete?')) {
                expensesData.list = expensesData.list.filter(e => e.id !== id);
                saveAll(); renderExpenses();
            }
        }

        function resetExpenses() {
            if(confirm('Reset all expense data?')) {
                expensesData = { budget: 0, list: [] };
                saveAll(); renderExpenses();
            }
        }

        function renderExpenses() {
            const total = expensesData.list.reduce((sum, item) => sum + item.amount, 0);
            const remaining = expensesData.budget - total;
            const percent = expensesData.budget > 0 ? (total / expensesData.budget) * 100 : 0;

            document.getElementById('displayBudget').innerText = formatMoney(expensesData.budget);
            document.getElementById('displaySpent').innerText = formatMoney(total);
            const balEl = document.getElementById('displayBalance');
            balEl.innerText = formatMoney(remaining);
            
            const prog = document.getElementById('progressBar');
            prog.style.width = `${Math.min(percent, 100)}%`;
            if(remaining < 0) {
                balEl.classList.replace('text-neonBlue', 'text-neonRed');
                prog.classList.replace('from-neonBlue', 'bg-neonRed');
                prog.classList.remove('to-neonPink');
            } else {
                balEl.classList.replace('text-neonRed', 'text-neonBlue');
                prog.classList.add('from-neonBlue', 'to-neonPink');
                prog.classList.remove('bg-neonRed');
            }

            const listEl = document.getElementById('expenseList');
            listEl.innerHTML = '';
            if(expensesData.list.length === 0) {
                document.getElementById('emptyState').classList.remove('hidden');
            } else {
                document.getElementById('emptyState').classList.add('hidden');
                expensesData.list.forEach(item => {
                    listEl.innerHTML += `
                        <tr class="group hover:bg-white/5 transition">
                            <td class="py-4 pl-4 align-middle">
                                <div class="text-xs text-gray-300 font-mono">${item.date}</div>
                                <div class="text-[10px] text-gray-500">${item.time}</div>
                            </td>
                            <td class="py-4 align-middle font-medium text-gray-200">${item.name}</td>
                            <td class="py-4 align-middle text-right font-mono text-neonBlue">₹${formatMoney(item.amount)}</td>
                            <td class="py-4 align-middle text-right pr-4"><button onclick="deleteExpense(${item.id})" class="text-gray-600 hover:text-red-400"><i class="fa-solid fa-xmark"></i></button></td>
                        </tr>
                    `;
                });
            }
            renderMonthlySummary();
        }

        function renderMonthlySummary() {
            const map = {};
            expensesData.list.forEach(e => {
                const key = new Date(e.id).toLocaleDateString('en-IN', { month: 'short', year: 'numeric' });
                map[key] = (map[key] || 0) + e.amount;
            });
            const container = document.getElementById('monthlySummaryList');
            container.innerHTML = '';
            Object.keys(map).forEach(k => {
                container.innerHTML += `
                    <div class="flex justify-between items-center bg-white/5 p-2 px-4 rounded-lg border border-white/5 text-xs w-full max-w-[200px]">
                        <span class="font-bold text-neonPurple">${k}</span>
                        <span class="font-mono text-gray-300">₹${formatMoney(map[k])}</span>
                    </div>
                `;
            });
        }

        // --- PEOPLE ---

        function addPerson() {
            const name = document.getElementById('newPersonName').value.trim();
            if(!name) return alert("Enter a name");
            
            peopleData.push({
                id: Date.now(),
                name: name,
                transactions: []
            });
            document.getElementById('newPersonName').value = '';
            saveAll(); renderPeopleGrid();
        }

        function calculatePersonBalance(person) {
            let totalGiven = 0;
            let totalGot = 0;
            person.transactions.forEach(t => {
                if(t.type === 'GAVE') totalGiven += t.amount;
                if(t.type === 'GOT') totalGot += t.amount;
            });
            return totalGiven - totalGot;
        }

        function renderPeopleGrid() {
            const grid = document.getElementById('peopleGrid');
            grid.innerHTML = '';
            
            if(peopleData.length === 0) {
                document.getElementById('peopleEmptyState').classList.remove('hidden');
            } else {
                document.getElementById('peopleEmptyState').classList.add('hidden');
                peopleData.forEach(p => {
                    const bal = calculatePersonBalance(p);
                    const isPositive = bal > 0;
                    
                    grid.innerHTML += `
                        <div onclick="openPersonDetails(${p.id})" class="glass-card p-6 rounded-2xl cursor-pointer hover:bg-white/10 transition group relative overflow-hidden flex flex-col items-center text-center">
                             <div class="absolute top-0 w-full h-1 ${isPositive ? 'bg-neonBlue' : (bal < 0 ? 'bg-red-500' : 'bg-gray-500')}"></div>
                             
                             <div class="w-12 h-12 rounded-full bg-white/5 flex items-center justify-center mb-3 border border-white/10">
                                <span class="font-bold text-lg text-gray-300">${p.name.charAt(0).toUpperCase()}</span>
                             </div>

                             <h3 class="font-bold text-lg text-white group-hover:text-neonBlue transition mb-1">${p.name}</h3>
                             
                             <span class="text-xl font-mono font-bold ${isPositive ? 'text-neonBlue' : (bal < 0 ? 'text-red-400' : 'text-gray-400')}">
                                ₹${formatMoney(Math.abs(bal))}
                             </span>
                             <p class="text-[10px] uppercase tracking-widest mt-1 ${isPositive ? 'text-neonBlue' : 'text-gray-500'}">${isPositive ? 'OWES YOU' : (bal < 0 ? 'YOU OWE' : 'SETTLED')}</p>
                        </div>
                    `;
                });
            }
        }

        function openPersonDetails(id) {
            activePersonId = id;
            const person = peopleData.find(p => p.id === id);
            if(!person) return;

            document.getElementById('detailPersonName').innerText = person.name;
            renderPersonDetailsInternal(person);
            
            const overlay = document.getElementById('personDetailOverlay');
            overlay.classList.remove('closed');
            overlay.classList.add('open');
        }

        function closePersonDetails() {
            document.getElementById('personDetailOverlay').classList.remove('open');
            document.getElementById('personDetailOverlay').classList.add('closed');
            activePersonId = null;
            renderPeopleGrid();
        }

        function renderPersonDetailsInternal(person) {
            const bal = calculatePersonBalance(person);
            const balEl = document.getElementById('detailBalance');
            const statusEl = document.getElementById('detailStatus');

            balEl.innerText = `₹${formatMoney(Math.abs(bal))}`;
            
            if(bal > 0) {
                balEl.className = "text-5xl font-mono font-bold text-neonBlue mb-2";
                statusEl.innerText = `${person.name} OWES YOU`;
                statusEl.className = "text-xs text-neonBlue uppercase tracking-widest";
            } else if (bal < 0) {
                balEl.className = "text-5xl font-mono font-bold text-red-500 mb-2";
                statusEl.innerText = `YOU OWE ${person.name}`;
                statusEl.className = "text-xs text-red-500 uppercase tracking-widest";
            } else {
                balEl.className = "text-5xl font-mono font-bold text-gray-500 mb-2";
                statusEl.innerText = "SETTLED";
                statusEl.className = "text-xs text-gray-500 uppercase tracking-widest";
            }

            const list = document.getElementById('personHistoryList');
            list.innerHTML = '';
            const sortedTx = [...person.transactions].sort((a,b) => b.id - a.id);

            if(sortedTx.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-600 py-4 text-xs">No records found.</div>';
            } else {
                sortedTx.forEach(tx => {
                    const isGave = tx.type === 'GAVE';
                    list.innerHTML += `
                        <div class="flex items-center justify-between bg-white/5 p-4 rounded-xl border border-white/5 mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full flex items-center justify-center ${isGave ? 'bg-red-500/10 text-red-400' : 'bg-green-500/10 text-green-400'}">
                                    <i class="fa-solid ${isGave ? 'fa-arrow-up' : 'fa-arrow-down'} text-xs"></i>
                                </div>
                                <div class="text-left">
                                    <p class="text-sm text-gray-200 font-medium">${tx.desc || (isGave ? 'Given' : 'Received')}</p>
                                    <p class="text-[10px] text-gray-500 font-mono">${tx.date}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-mono font-bold ${isGave ? 'text-red-400' : 'text-green-400'}">₹${formatMoney(tx.amount)}</p>
                                <button onclick="deletePersonTx(${tx.id})" class="text-[10px] text-gray-600 underline mt-1">Del</button>
                            </div>
                        </div>
                    `;
                });
            }
        }

        function deleteCurrentPerson() {
            if(confirm('Delete this person and all their records?')) {
                peopleData = peopleData.filter(p => p.id !== activePersonId);
                saveAll();
                closePersonDetails();
            }
        }

        function openTransactionModal(type) {
            activeTxType = type;
            document.getElementById('txModalType').innerText = type === 'GAVE' ? 'I GAVE (LENT)' : 'I GOT (REPAID)';
            document.getElementById('txModalType').className = type === 'GAVE' ? 'uppercase text-red-400 tracking-widest font-bold' : 'uppercase text-green-400 tracking-widest font-bold';
            document.getElementById('txInputModal').classList.remove('hidden');
        }

        function closeTxModal() {
            document.getElementById('txInputModal').classList.add('hidden');
            document.getElementById('txDesc').value = '';
            document.getElementById('txAmt').value = '';
        }

        function submitPersonTx() {
            const amt = parseFloat(document.getElementById('txAmt').value);
            const desc = document.getElementById('txDesc').value.trim();

            if(isNaN(amt) || amt <= 0) return alert("Enter valid amount");

            const personIndex = peopleData.findIndex(p => p.id === activePersonId);
            if(personIndex === -1) return;

            const now = new Date();
            peopleData[personIndex].transactions.push({
                id: Date.now(),
                type: activeTxType,
                amount: amt,
                desc: desc,
                date: now.toLocaleDateString('en-IN', { month: 'short', day: 'numeric' })
            });

            saveAll();
            closeTxModal();
            renderPersonDetailsInternal(peopleData[personIndex]);
        }

        function deletePersonTx(txId) {
            if(!confirm('Delete this transaction?')) return;
            const personIndex = peopleData.findIndex(p => p.id === activePersonId);
            if(personIndex === -1) return;

            peopleData[personIndex].transactions = peopleData[personIndex].transactions.filter(t => t.id !== txId);
            saveAll();
            renderPersonDetailsInternal(peopleData[personIndex]);
        }

        function saveAll() {
            localStorage.setItem('neonFlux_expenses_v2', JSON.stringify(expensesData));
            localStorage.setItem('neonFlux_people_v2', JSON.stringify(peopleData));
        }

        function loadData() {
            const e = localStorage.getItem('neonFlux_expenses_v2');
            if(e) expensesData = JSON.parse(e);
            
            const p = localStorage.getItem('neonFlux_people_v2');
            if(p) peopleData = JSON.parse(p);
        }

        function formatMoney(amount) {
            return new Intl.NumberFormat('en-IN', { minimumFractionDigits: 0, maximumFractionDigits: 2 }).format(amount);
        }
    </script>
</body>
</html>